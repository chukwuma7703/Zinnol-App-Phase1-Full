#!/bin/bash

# Pre-commit hook for Zinnol Backend
# Ensures code quality before commits

set -e

echo "ğŸ” Running pre-commit validation..."

# Check if we're in the backend directory
if [ ! -f "package.json" ]; then
    echo "âŒ Not in backend directory, skipping tests"
    exit 0
fi

# Run linting
echo "ğŸ“ Running ESLint..."
if ! npm run lint; then
    echo "âŒ Linting failed. Please fix the issues before committing."
    exit 1
fi

# Run smoke tests for fast feedback
echo "ğŸš€ Running smoke tests..."
if ! npm run test:smoke; then
    echo "âŒ Smoke tests failed. Please fix the issues before committing."
    exit 1
fi

# Run unit tests
echo "ğŸ§ª Running unit tests..."
if ! npm run test:unit; then
    echo "âŒ Unit tests failed. Please fix the issues before committing."
    exit 1
fi

echo "âœ… All pre-commit checks passed!"
echo "ğŸ’¡ Tip: Run './run-optimized-tests.sh full' before pushing for complete validation"